<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // const p1 = new Promise((res, rej) => {
      //   setTimeout(() => {
      //     res(100);
      //     rej();
      //   }, 1000);
      // });

      // p1.then(console.log);

      class IcePromise {
        constructor(executor) {
          this.STATUS = "padding";
          this.PADDING = "padding";
          this.FUlFILLED = "fulfilled";
          this.REJECT = "reject";
          this.value = undefined;
          this.fulfilledCallback = [];
          this.rejectCallback = [];

          // 不绑定this，上层作用域中的this
          this.resolve = (val) => {
            if (this.STATUS === this.PADDING) {
              this.value = val;
              this.STATUS = this.FUlFILLED;

              for (let fn of this.fulfilledCallback) {
                fn(this.value);
              }
            }
          };

          this.reject = (reason) => {
            if (this.STATUS === this.PADDING) {
              this.value = val;
              this.STATUS = this.REJECT;
            }
          };

          executor(this.resolve, this.reject);
        }

        then(onFulfilled) {
          this.fulfilledCallback.push(onFulfilled);
        }
      }

      const p = new IcePromise((resolve, reject) => {
        // setTimeout(() => {
        // }, 1000);
        resolve(100);
      });

      // 隐式绑定
      p.then((res) => {
        console.log(res);
      });
    </script>
  </body>
</html>
